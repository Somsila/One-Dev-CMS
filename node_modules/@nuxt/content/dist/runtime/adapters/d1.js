import { createDatabaseAdapter } from "../internal/database-adapter.js";
let db;
export default createDatabaseAdapter((opts) => {
  const binding = opts?.binding || "DB";
  if (!db) {
    db = process.env?.[binding] || globalThis.__env__?.[binding] || globalThis?.[binding];
  }
  return {
    async all(sql, params) {
      return (params ? db.prepare(sql).bind(...params).all() : db.prepare(sql).all()).then((res) => res.results);
    },
    async first(sql, params) {
      return params ? db.prepare(sql).bind(...params).first() : db.prepare(sql).first();
    },
    async exec(sql) {
      await db.exec(sql.replace(/\n+/g, " "));
    }
  };
});
