import { isAbsolute } from "pathe";
import Database from "better-sqlite3";
let db;
export const getBetter3DatabaseAdapter = (opts) => {
  if (!db) {
    const filename = !opts || isAbsolute(opts?.filename || "") ? opts?.filename : new URL(opts.filename, globalThis._importMeta_.url).pathname;
    db = new Database(process.platform === "win32" && filename.startsWith("/") ? filename.slice(1) : filename);
  }
  return {
    async all(sql, params) {
      return params ? db.prepare(sql).all(params) : db.prepare(sql).all();
    },
    async first(sql, params) {
      return params ? db.prepare(sql).get(params) : db.prepare(sql).get();
    },
    async exec(sql) {
      await db.exec(sql);
    }
  };
};
